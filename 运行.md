# 🎬 SmartVideoClipper 运行指南

> 全自动影视解说视频生成工具 - 详细安装和运行文档

---

## 📋 目录

1. [系统要求](#系统要求)
2. [一键安装（推荐）](#一键安装推荐)
3. [手动安装](#手动安装)
4. [配置环境变量](#配置环境变量)
5. [运行应用](#运行应用)
6. [使用说明](#使用说明)
7. [常见问题](#常见问题)

---

## 系统要求

### 硬件要求
| 组件 | 最低配置 | 推荐配置 |
|------|----------|----------|
| GPU | GTX 1080 (8GB显存) | RTX 3060+ (12GB+显存) |
| 内存 | 16GB | 32GB |
| 硬盘 | 50GB可用空间 | 100GB+ SSD |
| CPU | 4核心 | 8核心+ |

### 软件要求
- **操作系统**: Windows 10/11 (64位)
- **Python**: 3.10 或 3.11 (推荐3.10)
- **CUDA**: 11.8 或 12.1
- **FFmpeg**: 最新版本
- **Ollama**: 最新版本

---

## 一键安装（推荐）

### 🌟 智能安装脚本（全新推荐）

**右键以管理员身份运行 `智能安装.bat`**

这是我们全新开发的智能安装脚本，具备以下强大功能：

#### ✨ 核心特性

| 功能 | 说明 |
|------|------|
| 🔐 自动提权 | 自动请求管理员权限，无需手动操作 |
| 🔍 智能检测 | 自动检测已安装的软件，避免重复安装 |
| 🎮 GPU识别 | 自动识别NVIDIA显卡，配置最佳参数 |
| 📥 自动下载 | Python/FFmpeg/Ollama未安装时自动下载 |
| ⚙️ 环境配置 | 自动配置系统PATH环境变量 |
| 🧠 模型下载 | 自动下载AI文案模型（qwen2.5:7b）|

#### 📋 安装步骤

**步骤1**: 右键 `智能安装.bat` → **以管理员身份运行**

```
右键 → 以管理员身份运行 → 智能安装.bat
```

**步骤2**: 等待自动检测和安装

脚本会自动执行以下检测：
```
[1/8] 检查管理员权限...     ✅
[2/8] 检测系统信息...       ✅
[3/8] 检测NVIDIA显卡和CUDA... ✅
[4/8] 检测Python环境...     ✅ / 📥 自动安装
[5/8] 检测FFmpeg...         ✅ / 📥 自动安装
[6/8] 检测Ollama...         ✅ / 📥 自动安装
[7/8] 配置Python环境...     ✅
[8/8] 最终配置...           ✅
```

**步骤3**: 安装完成后选择是否立即启动

#### ⏱️ 预计时间

| 场景 | 时间 |
|------|------|
| 全新安装（无Python/FFmpeg/Ollama）| 20-40分钟 |
| 部分已安装 | 10-20分钟 |
| 仅需安装Python依赖 | 5-10分钟 |

### 📌 启动应用

安装完成后，双击 `启动.bat` 即可：

```
双击 启动.bat
```

会自动：
- ✅ 激活Python虚拟环境
- ✅ 启动Ollama服务
- ✅ 打开Web界面

---

### 旧版安装脚本（备用）

如果智能安装脚本遇到问题，可以使用旧版脚本：

```
双击 install_all.bat
```

然后运行：

```
双击 run.bat
```

---

## 手动安装

如果一键安装失败，请按以下步骤手动安装：

### 步骤1: 安装Python 3.10

1. 下载: https://www.python.org/downloads/release/python-31011/
2. 安装时勾选 **"Add Python to PATH"**
3. 验证安装:
```powershell
python --version
# 应显示: Python 3.10.x
```

### 步骤2: 安装CUDA工具包

1. 下载CUDA 11.8: https://developer.nvidia.com/cuda-11-8-0-download-archive
2. 安装（选择默认选项）
3. 验证安装:
```powershell
nvcc --version
# 应显示: Cuda compilation tools, release 11.8
```

### 步骤3: 安装FFmpeg

**方法A: 使用Chocolatey（推荐）**
```powershell
# 以管理员身份运行PowerShell
Set-ExecutionPolicy Bypass -Scope Process -Force
iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
choco install ffmpeg -y
```

**方法B: 手动安装**
1. 下载: https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip
2. 解压到 `C:\ffmpeg`
3. 添加 `C:\ffmpeg\bin` 到系统PATH环境变量
4. 验证:
```powershell
ffmpeg -version
```

### 步骤4: 安装Ollama

1. 下载: https://ollama.ai/download/windows
2. 安装并启动Ollama
3. 下载Qwen模型:
```powershell
ollama pull qwen2.5:7b
```
4. 验证:
```powershell
ollama list
# 应显示: qwen2.5:7b
```

### 步骤5: 创建Python虚拟环境

```powershell
cd C:\Users\Administrator\Desktop\jj\smart-video-clipper

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\Activate.ps1

# 如果遇到执行策略问题:
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 步骤6: 安装Python依赖

```powershell
# 确保虚拟环境已激活（命令行前有 (venv) 标识）

# 升级pip
python -m pip install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple

# 安装PyTorch (CUDA 11.8)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# 安装其他依赖
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 步骤7: 安装Chinese-CLIP（可选，用于封面生成）

```powershell
pip install cn-clip -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 配置环境变量

### 步骤1: 复制环境变量文件

```powershell
copy .env.example .env
```

### 步骤2: 编辑.env文件（可选）

用记事本打开 `.env` 文件，根据需要修改：

```ini
# GPU配置（通常不需要修改）
CUDA_VISIBLE_DEVICES=0

# Whisper模型（根据显存选择）
# 8GB显存: medium
# 12GB+显存: large-v3
WHISPER_MODEL=medium

# CLIP模型
CLIP_MODEL=ViT-B-16

# Ollama配置
OLLAMA_HOST=http://localhost:11434
OLLAMA_MODEL=qwen2.5:7b

# TTS引擎 (auto/chattts/edge)
TTS_ENGINE=auto

# HuggingFace镜像（国内用户必须设置）
HF_ENDPOINT=https://hf-mirror.com
```

---

## 运行应用

### 方式1: 图形界面（推荐新手）

```powershell
# 激活虚拟环境
cd C:\Users\Administrator\Desktop\jj\smart-video-clipper
.\venv\Scripts\Activate.ps1

# 启动Gradio界面
python app/gradio_ui.py
```

然后在浏览器打开: **http://localhost:7860**

### 方式2: 命令行（适合批量处理）

```powershell
# 激活虚拟环境
cd C:\Users\Administrator\Desktop\jj\smart-video-clipper
.\venv\Scripts\Activate.ps1

# 处理单个视频
python app/main_auto.py "D:\Movies\电影.mp4" "电影名称"
```

### 方式3: 双击运行

直接双击 **run.bat** 文件

---

## 使用说明

### 图形界面使用流程

1. **上传视频**
   - 点击"上传视频"按钮
   - 选择要处理的视频文件（支持mp4/mkv/avi/mov）

2. **填写信息（可选）**
   - 电影/剧名：用于联网搜索电影信息，提升文案质量
   - 输出名称：生成视频的文件名

3. **选择风格**
   - 幽默吐槽：类似谷阿莫风格
   - 正经解说：类似木鱼水心风格
   - 悬疑紧张：适合悬疑/惊悚片

4. **高级选项**
   - 联网搜索：开启后会从豆瓣获取电影信息
   - 目标时长：生成视频的目标长度（秒）

5. **点击"开始处理"**
   - 等待处理完成（2小时电影约需30-60分钟）

6. **下载结果**
   - 处理完成后可下载：成品视频、解说文案、视频封面、字幕文件

### 命令行参数说明

```powershell
python app/main_auto.py <视频路径> [电影名称] [输出名称] [风格]

# 示例
python app/main_auto.py "D:\电影\复仇者联盟.mp4" "复仇者联盟" "漫威解说" "幽默吐槽"
```

---

## 常见问题

### Q1: 提示"CUDA不可用"

**解决方案:**
```powershell
# 检查CUDA
python -c "import torch; print(torch.cuda.is_available())"

# 如果返回False，重新安装PyTorch:
pip uninstall torch torchvision torchaudio
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### Q2: 提示"FFmpeg未找到"

**解决方案:**
1. 确保FFmpeg已安装
2. 确保FFmpeg路径已添加到系统PATH
3. 重启PowerShell/命令行

```powershell
# 验证FFmpeg
ffmpeg -version
```

### Q3: 提示"Ollama连接失败"

**解决方案:**
1. 确保Ollama正在运行（查看系统托盘）
2. 检查Ollama状态:
```powershell
ollama list
```
3. 如果没有qwen2.5模型，下载:
```powershell
ollama pull qwen2.5:7b
```

### Q4: 显存不足(OOM)错误

**解决方案:**
1. 编辑 `.env` 文件，使用更小的模型:
```ini
WHISPER_MODEL=small
```
2. 关闭其他占用显存的程序
3. 重启后再试

### Q5: 下载依赖很慢

**解决方案:** 使用国内镜像
```powershell
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q6: Chinese-CLIP安装失败

**解决方案:**
```powershell
# 先安装依赖
pip install ftfy regex -i https://pypi.tuna.tsinghua.edu.cn/simple

# 再安装cn-clip
pip install cn-clip -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q7: 处理过程中卡住

**可能原因:**
1. 视频文件过大，正在处理中（查看CPU/GPU使用率）
2. 网络请求超时（联网搜索时）

**解决方案:**
1. 耐心等待，查看控制台输出
2. 如果超过30分钟无响应，Ctrl+C中断后重试

### Q8: 生成的文案质量不好

**解决方案:**
1. 填写正确的电影名称，开启联网搜索
2. 尝试不同的解说风格
3. 手动编辑生成的文案后重新合成

---

## 📁 输出文件说明

处理完成后，在 `workspace_输出名称` 目录下会生成：

| 文件 | 说明 |
|------|------|
| `抖音解说_final.mp4` | 成品视频（9:16竖屏） |
| `解说文案.txt` | AI生成的解说文案 |
| `subtitles.srt` | 字幕文件 |
| `cover.jpg` | 自动生成的封面 |
| `narration.wav` | 解说音频 |
| `clips/` | 剪辑的视频片段 |

---

## 🚀 性能参考

| 视频长度 | 处理时间(GTX 1080) | 处理时间(RTX 3060) |
|----------|-------------------|-------------------|
| 10分钟 | 5-8分钟 | 3-5分钟 |
| 30分钟 | 15-20分钟 | 10-15分钟 |
| 1小时 | 25-35分钟 | 18-25分钟 |
| 2小时 | 45-60分钟 | 30-45分钟 |

---

## 📞 技术支持

如遇到无法解决的问题：
1. 查看控制台错误信息
2. 检查 `temp/` 目录下的日志文件
3. 确保所有依赖版本正确

---

**祝您使用愉快！🎉**

